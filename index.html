<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ’° Quáº£n lÃ½ chi tiÃªu nhÃ³m</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>ğŸ’° Quáº£n lÃ½ chi tiÃªu nhÃ³m</h1>
    <div class="header-buttons">
      <button onclick="toggleTheme()" id="themeBtn">ğŸŒ™ Dark Mode</button>
      <button onclick="openMemberModal()">ğŸ‘¥ ThÃ nh viÃªn</button>
      <button onclick="logout()">ÄÄƒng xuáº¥t</button>
    </div>
  </header>

  <main>
    <div class="column" id="col1">
      <h2>Chi tiÃªu</h2>
      <button class="add-card" onclick="addCard(this)">+ ThÃªm chi tiÃªu</button>
    </div>

    <div class="column" id="col2">
      <h2 onclick="renameColumn(this)">ThÃ¡ng 10</h2>
      <button class="add-card" onclick="addCard(this)">+ ThÃªm ghi chÃº</button>
    </div>

    <div class="column" id="col3">
      <h2>Quyáº¿t toÃ¡n</h2>
      <div class="card">Tá»•ng chi: 0Ä‘</div>
      <div class="card">Chia Ä‘á»u: 0Ä‘/ngÆ°á»i</div>
      <button class="add-card" onclick="calculate()">ğŸ’¡ TÃ­nh tá»•ng</button>
    </div>

    <div class="column" id="col4">
      <h2>Chia tiá»n</h2>
      <div id="shareList"></div>
    </div>
  </main>

  <!-- Popup thÃ nh viÃªn -->
  <div id="memberModal">
    <div class="modal-content">
      <h3>Danh sÃ¡ch thÃ nh viÃªn</h3>
      <ul class="member-list" id="memberList"></ul>
      <input type="text" id="newMember" placeholder="TÃªn thÃ nh viÃªn..." />
      <button onclick="addMember()">ThÃªm</button>
      <br />
      <button onclick="closeMemberModal()">ÄÃ³ng</button>
    </div>
  </div>

  <script>
    // ======= ÄÄƒng xuáº¥t =======
    function logout() {
      alert("ÄÄƒng xuáº¥t thÃ nh cÃ´ng!");
      window.location.href = "login.html";
    }

    // ======= Äá»•i tÃªn báº£ng =======
    function renameColumn(title) {
      const newName = prompt("Nháº­p tÃªn má»›i cho báº£ng:", title.textContent);
      if (newName && newName.trim() !== "") title.textContent = newName.trim();
    }

    // ======= ThÃªm tháº» =======
    function addCard(btn) {
      const column = btn.parentElement;
      const text = prompt("Nháº­p ná»™i dung:");
      if (text && text.trim() !== "") {
        const card = document.createElement("div");
        card.className = "card";
        card.draggable = true;
        card.textContent = text;
        addDragEvents(card);
        column.insertBefore(card, btn);
      }
    }

    // ======= KÃ©o tháº£ =======
    function addDragEvents(card) {
      card.addEventListener("dragstart", () => card.classList.add("dragging"));
      card.addEventListener("dragend", () => card.classList.remove("dragging"));
    }

    document.querySelectorAll(".card").forEach(addDragEvents);
    document.querySelectorAll(".column").forEach((col) => {
      col.addEventListener("dragover", (e) => {
        e.preventDefault();
        const dragging = document.querySelector(".dragging");
        const addBtn = col.querySelector(".add-card");
        col.insertBefore(dragging, addBtn);
      });
    });

    // ======= Popup ThÃ nh viÃªn =======
    const memberModal = document.getElementById("memberModal");
    const memberList = document.getElementById("memberList");
    const newMemberInput = document.getElementById("newMember");

    function openMemberModal() {
      memberModal.style.display = "flex";
      loadMembers();
    }

    function closeMemberModal() {
      memberModal.style.display = "none";
    }

    function loadMembers() {
      const members = JSON.parse(localStorage.getItem("members") || "[]");
      memberList.innerHTML = members
        .map(
          (m, i) =>
            `<li>ğŸ‘¤ ${m} <button class="delete-btn" onclick="removeMember(${i})">âŒ</button></li>`
        )
        .join("");
    }

    function addMember() {
      const name = newMemberInput.value.trim();
      if (!name) return alert("Nháº­p tÃªn thÃ nh viÃªn!");
      let members = JSON.parse(localStorage.getItem("members") || "[]");
      if (members.includes(name)) return alert("ThÃ nh viÃªn Ä‘Ã£ tá»“n táº¡i!");
      members.push(name);
      localStorage.setItem("members", JSON.stringify(members));
      newMemberInput.value = "";
      loadMembers();
    }

    function removeMember(index) {
      let members = JSON.parse(localStorage.getItem("members") || "[]");
      members.splice(index, 1);
      localStorage.setItem("members", JSON.stringify(members));
      loadMembers();
    }

    // ======= TÃ­nh toÃ¡n =======
    function calculate() {
      const expenses = document.querySelectorAll("#col1 .card");
      let total = 0;
      expenses.forEach((c) => {
        const num = c.textContent.match(/\d+/);
        if (num) total += parseInt(num[0]);
      });

      const members = JSON.parse(localStorage.getItem("members") || "[]");
      if (members.length === 0) return alert("ChÆ°a cÃ³ thÃ nh viÃªn!");

      const perPerson = total / members.length;
      document.querySelector("#col3 .card:nth-child(2)").textContent = `Tá»•ng chi: ${total.toLocaleString()}Ä‘`;
      document.querySelector("#col3 .card:nth-child(3)").textContent = `Chia Ä‘á»u: ${perPerson.toLocaleString()}Ä‘/ngÆ°á»i`;

      const shareList = document.getElementById("shareList");
      shareList.innerHTML = members
        .map((m) => `<div class="card">${m}: ${perPerson.toLocaleString()}Ä‘</div>`)
        .join("");
    }

    // ======= Light / Dark Mode =======
    const themeBtn = document.getElementById("themeBtn");
    const currentTheme = localStorage.getItem("theme") || "dark";

    document.body.classList.toggle("light", currentTheme === "light");
    updateThemeButton();

    function toggleTheme() {
      document.body.classList.toggle("light");
      const isLight = document.body.classList.contains("light");
      localStorage.setItem("theme", isLight ? "light" : "dark");
      updateThemeButton();
    }

    function updateThemeButton() {
      const isLight = document.body.classList.contains("light");
      themeBtn.textContent = isLight ? "â˜€ï¸ Light Mode" : "ğŸŒ™ Dark Mode";
    }
  </script>
</body>
</html>
